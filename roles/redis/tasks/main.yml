---
# tasks file for redis
# make PREFIX=/home/susu/lek/redis-2.6.16/
# make PREFIX=/home/susu/lek/redis-2.6.16/ install
# cd utils
# ./install_server
- name: create directory
  file: path="{{base_home}}" state=directory

- name: unpack tarball to remote node
  unarchive: src="{{redis_tarball}}" dest="{{base_home}}"

- name: check if unpack module worked
  stat: path="{{logstash_home}}"
  ignore_errors: true
  register: unpack_check

- fail: msg="unpack redis failed!"
  when: unpack_check.stat.exists == false

- name: update ENV
  lineinfile:
    dest: "{{env_profile}}"
    line: "export PATH={{redis_home}}/bin:$PATH"
    state: present

- name: compile srouce code
  command: "make PREFIX={{redis_home}} install"
  register: compile_result

- name: configuraiont file
  template: src="{{item.src}}" dest="{{item.dest}}"
  with_items:
    - {src:"{{redis_config}}.j2", dest:"/etc/{{redis_config}}"}
    - {src:"{{redis_init}}.j2", dest:"/etc/init.d/{{redis_init}}"}
